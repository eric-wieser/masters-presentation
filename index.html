<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Machine learning for a miniature robotic unicycle</title>

		<link rel="stylesheet" href="reveal.js/css/reveal.css">
		<link rel="stylesheet" href="reveal.js/css/theme/solarized.css">
		<link rel="stylesheet" href="build/mathbox.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="solarized-dark.min.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<style>
		.reveal .two-col {
			flex: 1;
			display: flex;
			flex-flow: row nowrap;
			align-items: center;
			margin-bottom: 20px;
		}
		.two-col > div {flex: 1; text-align: left;}
		.two-col > div > img { object-fit: contain; }

		.abs-tc {
			position: absolute;
			bottom: 50px !important;
			left: 50px !important;
			right: 50px !important;
			top: auto !important;
			z-index: 20;
		}
		.abs-tc {
			position: absolute;
			bottom: auto !important;
			left: 50px !important;
			right: 50px !important;
			top: 50px !important;
			z-index: 20;
		}
		section {
			padding: 20px !important;
			min-height: 100%;
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
			justify-content: center;;
		}
		section.smaller {
			font-size: 80%;
		}
		section.stack { padding: 0px !important; }

		div.fill-photo {
			background-size: contain;
			background-position: 50% 50%;
			background-repeat: no-repeat;
		}

		.reveal h2 small {
			font-size: 0.25em;
			color: gray;
			display: block;
			margin-top: -0.5em;
		}

		.reveal h4 small {
			line-height: inherit;
			vertical-align: middle;
			opacity: 0.75;
		}

		.reveal h1 {
			font-size: 2.5em;
		}

		.reveal .bytes {
			background:#002b36;
			color:#839496;
			display: inline-block;
			font-size: 0.75em;
			padding: 0 0.1em;
			line-height: 1em;
		}

		.bytes b {
			font-family: monospace;
			font-weight: normal;
		}

		.c-blue { color: rgb(0, 114, 189); }
		.c-orange { color: rgb(217, 83, 25); }
		.c-yellow { color: rgb(237, 177, 32); }
		.c-purple { color: rgb(126, 47, 142); }
		.c-green { color: rgb(119, 172, 48); }
		.c-cyan { color: rgb(77, 190, 238); }
		.c-red { color: rgb(162, 20, 47); }

		.pilco {font-variant: small-caps !important; }

		.flex-row {
			display: flex;
			justify-content: space-between;
			align-items: center;
			flex-shrink: 0;
		}

		.invisible { visibility: hidden; }

		.reveal sup {
			font-size: 0.75em;
		}
		</style>
	</head>
	<body>
		<div style="display: none">\[
		\newcommand{\tind}[1]{^{(#1)}}
		\DeclareMathOperator*{\argmin}{arg\,min}
		\newcommand{\bm}[1]{\mathbf{#1}}
		\]</div>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Machine learning for a miniature robotic unicycle</h1>
					<p>Eric Wieser (<code>efw27@</code>)</p>
					<p><small>Supervised by Prof. Carl Rasmussen (<code>cer54@</code>)</small></p>
					<aside class="notes">
						Hi, I’m Eric, and my project is on using Machine Learning to find a controller for a miniature unicycle
					</aside>
				</section>

				<section>
					<h2>Project goals</h2>
					<div class="two-col">
						<div class="fill-photo" style="align-self: stretch; background-image: url(images/front.png)"></div>
						<div>
							<p class="fragment">Balance this unicycle</p>
							<p class="fragment">Fix problems identified in previous work</p>
							<p class="fragment">Improve the tools to make similar projects easier in future</p>
						</div>
					</div>
					<aside class="notes">
						The main goal of course, is to balance this unicycle.

						This isn't the first time that's been tried - previous work showed some success, but raised a lot of issues.

						The final goal was to try and improve the tools to expose issues more clearly.
					</aside>
				</section>

				<section>
					<section>
						<aside class="notes">
							A useful technique in control theory is optimal control, which lets you quantify how good a controller is, and then pick the best one.

							Problem is, this needs a system model - and if the model is wrong, then the controller is unlikely to be optimal or stable.

							TODO
						</aside>
						<h2><span class="pilco">Pilco</span><small>Probabilistic Inference for Learning Control</small></h2>
						<div class="fragment" data-fragment-index="1">
							<p>
								Optimal control finds a <span class="c-blue">policy</span> for a <span class="c-green">system</span>
								minimizing a <span class="c-purple">cost function</span> over a horizon
							</p>
							<small>\[
								\begin{alignat}{2}
								\text{find}&& \quad
									\pi^*(\bm{x}) &= \argmin_{\pi(\bm{x})}
										J(\bm{x}\tind\cdot, \bm{u}\tind\cdot)
										\quad \text{where} \quad
										J(\bm{x}\tind\cdot, \bm{u}\tind\cdot) = \sum_{i=0}^{i=N}
										\class{c-purple}{c(\bm{x}\tind{i}, \bm{u}\tind{i})}\quad \\ \label{eq:optimal}
								\text{st.}&& \quad
									\class{c-green}{\bm{x}\tind{i+1}} &\class{c-green}{= f(\bm{x}\tind{i}, \bm{u}\tind{i})} \\ \nonumber
								&&
									\class{c-blue}{\bm{u}\tind{i}} &\class{c-blue}{= \pi(\bm{x}\tind{i})}\, \nonumber
							\end{alignat}
							\]</small>
						</div>
						<div class="fragment" data-fragment-index="2">
							<p>
								Needs a <span class="c-green">system model</span>
								<span class="fragment"  data-fragment-index="3">&mdash; <span class="pilco">Pilco</span> learns a probabilistic one using <span class="c-cyan">Gaussian process</span> regression</span>
							</p>
							<small class="fragment" data-fragment-index="3">\[
								\begin{align}
									\bm{x}\tind{i + 1} - \bm{x}\tind{i} &= \class{c-cyan}{f_j(\bm{z}\tind{i})
									\sim \mathrm{GP}(m_j(\bm{z}), K_j(\bm{z}_1, \bm{z}_2))},
									&
									\bm{z}\tind{i} &= \begin{bmatrix}\bm{x}\tind{i} \\ \bm{u}\tind{i}\end{bmatrix}
								\end{align}
							\]</small>
						</div>
					</section>
					<section>
						<h3>Gaussian processes</h3>
						<p>TODO</p>
					</section>
				</section>

				<section>
					<section data-transition="convex">
						<h2>Outstanding issues</h2>
						<p class="fragment">
							Automate data transfer with the
							hardware&nbsp;<span class="invisible c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p class="invisible">
							Improve release procedure&nbsp;<span class="c-green mathbox-outline-2" style="font-size: 1.5em">✔</span>
						</p>
						<p class="invisible">
							Add simulation model of the small
							unicycle&nbsp;<span class="c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p class="invisible">
							Redesign the hardware to increase the roll
							limit&nbsp;<strong class="c-yellow mathbox-outline-2" style="font-size: 1.5em">?</strong></p>
					</section>
					<section data-transition="convex">
						<h3>Data transfer</h3>
						<div class="fragment">
							<h4>COBS <small>Consistent Overhead Byte Stuffing</small></h4>
							<div class="flex-row">
								<div>
									Messages<br />
									<span class="bytes">
										<b>F1</b> <b>00</b> <b>D5</b>
									</span>, <span class="bytes">
										<b>0F</b>
									</span>, <span class="bytes">
										<b>C0</b> <b>FF</b> <b>EE</b>
									</span><br/>
									<small></small>
								</div>
								&rarr;
								<div class="fragment">
									Stream<br />
									<span class="bytes">
										<b class="c-orange">02</b> <b>F1</b> <b class="c-orange">02</b> <b>D5</b> <b class="c-blue">00</b>
										<b class="c-orange">02</b> <b>0F</b> <b class="c-blue">00</b>
										<b class="c-orange">04</b> <b>C0</b> <b>FF</b> <b>EE</b> <b class="c-blue">00</b>
									</span><br/>
									<small><span class="c-orange">Count</span> and <span class="c-blue">null-terminator</span> bytes</small>
								</div>
							</div>
						</div>
						<div class="fragment">
							<h4>Protobuf <small>Protocol buffers</small></h4>
							<pre><code data-trim class="protobuf">
								syntax = "proto3";
								message DebugMessage {
									string s = 1;
									DebugLevel level = 2;
								}
								message RobotMessage {
									oneof msg {
										LogBundle log_bundle = 1;
										DebugMessage debug = 2;
										LogEntry single_log = 3;
									}
								}
							</code></pre>
						</div>
					</section>
					<section>
						<h2>Outstanding issues</h2>
						<p>
							Automate data transfer with the
							hardware&nbsp;<span class="c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p class="fragment">
							Improve release procedure&nbsp;<span class="invisible c-green mathbox-outline-2" style="font-size: 1.5em">✔</span>
						</p>
						<p class="invisible">
							Add simulation model of the small
							unicycle&nbsp;<span class="invisible c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p class="invisible">
							Redesign the hardware to increase the roll
							limit&nbsp;<strong class="c-yellow mathbox-outline-2" style="font-size: 1.5em">?</strong></p>
					</section>
					<section>
						<h3>Release procedure</h3>
						<h4>Reaction times</h4>
						<div class="two-col">
							<div>
								<div class="fragment">
								<small style="font-size: 0.25em; display: block">
									Gideon Praveen Kumar Jose Shelton. “Comparison between Auditory and Visual Simple
		Reaction Times”. In: Neuroscience and Medicine 1.1 (2010)
								</small>
								Human visual &mdash; 330ms</div>
								<div class="fragment">Human audio &mdash; 280ms</div>
								
								<div class="fragment">Arduino switch release &mdash; <i>really fast!</i></div>
							</div>
							<div class="fragment fill-photo" style="align-self: stretch; flex: 0.5; background-image: url(images/electronic-back.png);"> </div>
						</div>
						<div class="fragment">
							<h4>Repeatability of orientation</h4>
							<ul>
								<li>Build a rig to drop perfectly <em class="c-red fragment" style="font-size: 0.75em">✘ Impractical</em></li>
								<li>Learn the initial orientation <em class="c-red fragment" style="font-size: 0.75em">✘ Must be online</em></li>
								<li class="fragment">Measure the initial orientation <em class="c-green fragment" style="font-size: 0.75em">✔ Use the accelerometer</em></li>
							</ul>
						</div>
					</section>
					<section>
						<h2>Outstanding issues</h2>
						<p>
							Automate data transfer with the
							hardware&nbsp;<span class="c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p>
							Improve release procedure&nbsp;<span class="c-green mathbox-outline-2" style="font-size: 1.5em">✔</span>
						</p>
						<p class="fragment">
							Add simulation model of the small
							unicycle&nbsp;<span class="invisible c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p class="invisible">
							Redesign the hardware to increase the roll
							limit&nbsp;<strong class="c-yellow mathbox-outline-2" style="font-size: 1.5em">?</strong></p>
					</section>
					<section>
						<h2>Simulation models</h2>
						<p>Software-only tests of <span class="pilco">Pilco</span></p>
						<p>Only have a model for the 1m unicycle</p>
						<p>Approximations good enough</p>
					</section>
					<section>
						<h2>Outstanding issues</h2>
						<p>
							Automate data transfer with the
							hardware&nbsp;<span class="c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p>
							Measure initial robot orientation
							accelerometer&nbsp;<span class="c-green mathbox-outline-2" style="font-size: 1.5em">✔</span>
						</p>
						<p>
							Add simulation model of the small
							unicycle&nbsp;<span class="fragment c-green mathbox-outline-2" style="font-size: 1.5em">✔</span></p>
						<p class="fragment">
							Redesign the hardware to increase the roll
							limit&nbsp;<strong class="fragment c-yellow mathbox-outline-2" style="font-size: 1.5em">?</strong></p>
					</section>
				</section>

				<section data-background-isframe="loss.html">
					<section data-transition="fade">
						<h2>Effect of roll limit</h2>
						<aside class="notes">
						Let's take a look at the performance of the simulation
						</aside>
					</section>
					<section data-transition="fade">
						<aside class="notes">
							An easy way to measure this is simply how long the robot stays upright, as a function of iteration number.
							Here's what we get for an idealized unicycle.
						</aside>
						<div class="abs-tc mathbox-outline-2">\[
							\theta_\text{max} =
								\class{c-blue}{90&deg;}
						\]</div>
					</section>
					<section data-transition="fade">
						<aside class="notes">
							And here's the unicycle with the roll limit modelled. Clearly, there's a problem.
							Earlier work suggested we redo the frame to reduce this - optimistically, 45 degrees is achievable.
						</aside>
						<div class="abs-tc mathbox-outline-2">\[
							\theta_\text{max} =
								\class{c-blue}{90&deg;},\quad
								\class{c-yellow}{17&deg;}
						\]</div>
					</section>
					<section data-transition="fade">
						<aside class="notes">
							But that doesn't really help.
							We can't get much more from this graph as is.
						</aside>
						<div class="abs-tc mathbox-outline-2">\[
							\theta_\text{max} =
								\class{c-blue}{90&deg;},\quad
								\class{c-orange}{45&deg;},\quad
								\class{c-yellow}{17&deg;}
						\]</div>
					</section>
					<section data-transition="fade">
						<aside class="notes">
							Let's add a line to represent each run of the robot...
						</aside>
					</section>
					<section data-transition="fade">
						<aside class="notes">
							so that we can introduce another dimension, plotting the loss function over time
						</aside>
						<div class="abs-tc mathbox-outline-2">\[
							L(\mathbf{x}) = 1 - \exp\left(-\frac{1}{2}\left[
								\tfrac{d(\mathbf x)^2}{h^2} +
								\tfrac{\phi^2}{(4\pi)^2}
							\right]\right)
						\]</div>
					</section>
					<section data-transition="fade">
						<aside class="notes">
						</aside>
					</section>
					<section data-transition="fade">
						<aside class="notes">
						</aside>
					</section>
					<section data-transition="fade">
						<aside class="notes">
						</aside>
					</section>
				</section>
			</div>
		</div>

		<script src="reveal.js/lib/js/head.min.js"></script>
		<script src="reveal.js/js/reveal.js"></script>

		<script>
			var addProtobuf = function() {
				hljs.getLanguage('protobuf').k.keyword += ' oneof';
			};
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'reveal.js/plugin/markdown/marked.js' },
					{ src: 'reveal.js/plugin/markdown/markdown.js' },
					{ src: 'reveal.js/plugin/math/math.js', async: true },
					{ src: 'reveal.js/plugin/notes/notes.js', async: true },
					{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() {
						addProtobuf(); hljs.initHighlightingOnLoad();
					} }
				],
				math: {
					mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
					config: 'TeX-AMS_HTML-full'  // See http://docs.mathjax.org/en/latest/config-files.html
				},

				history: true,
				// width: "100%",
				// height: "100%",
				// margin: 0,
				// minScale: 0.2,
				// maxScale: 1.5,
				center: false,
				transition: 'convex',
				display: 'flex'
			});

			var updateIframe = function (inds, el) {
				var bg = Reveal.getSlideBackground(inds.h);
				var iframe = bg.querySelector('iframe');
				if (!el || el == iframe) {
					iframe.contentWindow.postMessage(JSON.stringify({
						namespace: 'reveal', eventName: 'slide', value: inds.v
					}), '*');
				}
			};

			Reveal.addEventListener( 'ready', function() {
				Array.from(document.querySelectorAll('iframe')).forEach(function(el) {
					el.addEventListener('load', function() {
						updateIframe(Reveal.getIndices());
					});
				});
			});
			Reveal.addEventListener( 'slidechanged', function(e) {
				updateIframe(Reveal.getIndices(e.currentSlide));
			});

		</script>
	</body>
</html>
